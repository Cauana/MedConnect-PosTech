type: collection.insomnia.rest/5.0
schema_version: "5.1"
name: MedConnect - testes com enfermeiro, medico e paciente
meta:
  id: wrk_866fd09e383646b6a562fffb39887507
  created: 1767565545898
  modified: 1767577957533
  description: ""
collection:
  - name: MedConnect - testes com enfermeiro, medico e paciente
    meta:
      id: fld_9f1bac08e074433a934d5236aa8ea533
      created: 1767565545905
      modified: 1767577953902
      sortKey: -1767565544392
      description: ""
    children:
      - url: http://localhost:8080/auth/login
        name: 1 - Admin Login
        meta:
          id: req_88189d963a0a4576b9894f9f4b31165f
          created: 1767565545911
          modified: 1767565545911
          isPrivate: false
          description: ""
          sortKey: -1767565544391
        method: POST
        body:
          mimeType: text/plain
          text: |-
            {
              "usuario": "admin",
              "senha": "admin"
            }
        headers:
          - name: Content-Type
            value: application/json
        scripts:
          afterResponse: >-
            if (insomnia.response.code === 200) {
              insomnia.environment.set('admin_token', insomnia.response.json().token);
            }
        settings:
          renderRequestBody: true
          encodeUrl: true
          followRedirects: global
          cookies:
            send: true
            store: true
          rebuildPath: true
      - url: http://localhost:8080/auth/register
        name: 2 - Register Medico (auth)
        meta:
          id: req_e4b663efbc774762add927e6a7381d80
          created: 1767565545919
          modified: 1767565545919
          isPrivate: false
          description: ""
          sortKey: -1767565544390
        method: POST
        body:
          mimeType: text/plain
          text: |-
            {
              "usuario": "medico1",
              "senha": "med123",
              "role": "MEDICO"
            }
        headers:
          - name: Content-Type
            value: application/json
        settings:
          renderRequestBody: true
          encodeUrl: true
          followRedirects: global
          cookies:
            send: true
            store: true
          rebuildPath: true
      - url: http://localhost:8080/auth/register
        name: 3 - Register Enfermeiro (auth)
        meta:
          id: req_417f85568eeb444ca8512c1b1370f1ce
          created: 1767565545925
          modified: 1767565545925
          isPrivate: false
          description: ""
          sortKey: -1767565544389
        method: POST
        body:
          mimeType: text/plain
          text: |-
            {
              "usuario": "enf1",
              "senha": "enf123",
              "role": "ENFERMEIRO"
            }
        headers:
          - name: Content-Type
            value: application/json
        settings:
          renderRequestBody: true
          encodeUrl: true
          followRedirects: global
          cookies:
            send: true
            store: true
          rebuildPath: true
      - url: http://localhost:8080/auth/register
        name: 4 - Register Pacientes (auth) - pac1 & pac2
        meta:
          id: req_8c3ead7424064969adae9c61159d0b9a
          created: 1767565545930
          modified: 1767565545930
          isPrivate: false
          description: ""
          sortKey: -1767565544388
        method: POST
        body:
          mimeType: text/plain
          text: |-
            {
              "usuario": "pac1",
              "senha": "pac123",
              "role": "PACIENTE"
            }
        headers:
          - name: Content-Type
            value: application/json
        settings:
          renderRequestBody: true
          encodeUrl: true
          followRedirects: global
          cookies:
            send: true
            store: true
          rebuildPath: true
      - url: http://localhost:8080/auth/register
        name: 5 - Register Paciente 2 (auth)
        meta:
          id: req_bc701233d5df424a920711fb670335db
          created: 1767565545935
          modified: 1767565545935
          isPrivate: false
          description: ""
          sortKey: -1767565544387
        method: POST
        body:
          mimeType: text/plain
          text: |-
            {
              "usuario": "pac2",
              "senha": "pac234",
              "role": "PACIENTE"
            }
        headers:
          - name: Content-Type
            value: application/json
        settings:
          renderRequestBody: true
          encodeUrl: true
          followRedirects: global
          cookies:
            send: true
            store: true
          rebuildPath: true
      - url: http://localhost:8081/usuarios
        name: 6 - Create profiles (agendamento) as admin
        meta:
          id: req_fd63126fe1c246c8be7b2cb2cc9a1770
          created: 1767565545941
          modified: 1767565545941
          isPrivate: false
          description: ""
          sortKey: -1767565544386
        method: POST
        body:
          mimeType: text/plain
          text: |-
            {
              "nome": "Dr. João Médico",
              "cpf": "11111111111",
              "email": "medico1@example.com",
              "dataNascimento": "1980-01-01",
              "tipo": "MEDICO"
            }
        headers:
          - name: Content-Type
            value: application/json
          - name: Authorization
            value: Bearer {{admin_token}}
        authentication:
          type: bearer
          disabled: false
          token: "{{admin_token}}"
          prefix: ""
        scripts:
          afterResponse: >-
            if (insomnia.response.code === 200 || insomnia.response.code ===
            201) {
              insomnia.environment.set('medico_profile_id', insomnia.response.json().id);
            }
        settings:
          renderRequestBody: true
          encodeUrl: true
          followRedirects: global
          cookies:
            send: true
            store: true
          rebuildPath: true
      - url: http://localhost:8081/usuarios
        name: 7 - Create enfermeiro profile (agendamento)
        meta:
          id: req_ac53b860c1e34992afc89c957705b426
          created: 1767565545946
          modified: 1767565545946
          isPrivate: false
          description: ""
          sortKey: -1767565544385
        method: POST
        body:
          mimeType: text/plain
          text: |-
            {
              "nome": "Enf. Maria",
              "cpf": "22222222222",
              "email": "enf1@example.com",
              "dataNascimento": "1990-05-05",
              "tipo": "ENFERMEIRO"
            }
        headers:
          - name: Content-Type
            value: application/json
          - name: Authorization
            value: Bearer {{admin_token}}
        authentication:
          type: bearer
          disabled: false
          token: "{{admin_token}}"
          prefix: ""
        scripts:
          afterResponse: >-
            if (insomnia.response.code === 200 || insomnia.response.code ===
            201) {
              insomnia.environment.set('enf_profile_id', insomnia.response.json().id);
            }
        settings:
          renderRequestBody: true
          encodeUrl: true
          followRedirects: global
          cookies:
            send: true
            store: true
          rebuildPath: true
      - url: http://localhost:8081/usuarios
        name: 8 - Create paciente profiles (agendamento)
        meta:
          id: req_d6195b65fb92474fa61ab93b602c8f2b
          created: 1767565545972
          modified: 1767565545972
          isPrivate: false
          description: ""
          sortKey: -1767565544384
        method: POST
        body:
          mimeType: text/plain
          text: |-
            {
              "nome": "Paciente 1",
              "cpf": "33333333333",
              "email": "pac1@example.com",
              "dataNascimento": "2000-02-02",
              "tipo": "PACIENTE"
            }
        headers:
          - name: Content-Type
            value: application/json
          - name: Authorization
            value: Bearer {{admin_token}}
        authentication:
          type: bearer
          disabled: false
          token: "{{admin_token}}"
          prefix: ""
        scripts:
          afterResponse: >-
            if (insomnia.response.code === 200 || insomnia.response.code ===
            201) {
              insomnia.environment.set('paciente_profile_id', insomnia.response.json().id);
            }
        settings:
          renderRequestBody: true
          encodeUrl: true
          followRedirects: global
          cookies:
            send: true
            store: true
          rebuildPath: true
      - url: http://localhost:8081/usuarios
        name: 9 - Create paciente2 profile (agendamento)
        meta:
          id: req_dc049842d0cd48feb517fae3b7fcea02
          created: 1767565545977
          modified: 1767565545977
          isPrivate: false
          description: ""
          sortKey: -1767565544383
        method: POST
        body:
          mimeType: text/plain
          text: |-
            {
              "nome": "Paciente 2",
              "cpf": "44444444444",
              "email": "pac2@example.com",
              "dataNascimento": "2001-03-03",
              "tipo": "PACIENTE"
            }
        headers:
          - name: Content-Type
            value: application/json
          - name: Authorization
            value: Bearer {{admin_token}}
        authentication:
          type: bearer
          disabled: false
          token: "{{admin_token}}"
          prefix: ""
        scripts:
          afterResponse: >-
            if (insomnia.response.code === 200 || insomnia.response.code ===
            201) {
              insomnia.environment.set('paciente2_profile_id', insomnia.response.json().id);
            }
        settings:
          renderRequestBody: true
          encodeUrl: true
          followRedirects: global
          cookies:
            send: true
            store: true
          rebuildPath: true
      - url: http://localhost:8080/auth/login
        name: 10 - Login Enfermeiro
        meta:
          id: req_eed90a120ede483f91554c6ebdfb1ccc
          created: 1767565545979
          modified: 1767565545979
          isPrivate: false
          description: ""
          sortKey: -1767565544382
        method: POST
        body:
          mimeType: text/plain
          text: |-
            {
              "usuario": "enf1",
              "senha": "enf123"
            }
        headers:
          - name: Content-Type
            value: application/json
        scripts:
          afterResponse: if (insomnia.response.code === 200)
            insomnia.environment.set('enfermeiro_token',
            insomnia.response.json().token);
        settings:
          renderRequestBody: true
          encodeUrl: true
          followRedirects: global
          cookies:
            send: true
            store: true
          rebuildPath: true
      - url: http://localhost:8081/consultas
        name: 11 - Enfermeiro registra consulta para pac1
        meta:
          id: req_a023322a65e446beb7cc2cb2b706e151
          created: 1767565545981
          modified: 1767565545981
          isPrivate: false
          description: ""
          sortKey: -1767565544381
        method: POST
        body:
          mimeType: text/plain
          text: |-
            {
              "idPaciente": {{_['paciente_profile_id']}},
              "idMedico": {{_['medico_profile_id']}},
              "dataHora": "2026-02-20T14:30:00",
              "observacoes": "Criada pelo enfermeiro"
            }
        headers:
          - name: Content-Type
            value: application/json
          - name: Authorization
            value: Bearer {{enfermeiro_token}}
        authentication:
          type: bearer
          disabled: false
          token: "{{enfermeiro_token}}"
          prefix: ""
        scripts:
          afterResponse: if (insomnia.response.code === 201 || insomnia.response.code ===
            200) insomnia.environment.set('consulta_by_enf',
            insomnia.response.json().id);
        settings:
          renderRequestBody: true
          encodeUrl: true
          followRedirects: global
          cookies:
            send: true
            store: true
          rebuildPath: true
      - url: http://localhost:8081/consultas
        name: 12 - Enfermeiro lista todas as consultas (verifica presente)
        meta:
          id: req_6a96e66244724f6890bbeae0279df614
          created: 1767565545983
          modified: 1767565545983
          isPrivate: false
          description: ""
          sortKey: -1767565544380
        method: GET
        headers:
          - name: Authorization
            value: Bearer {{enfermeiro_token}}
        authentication:
          type: bearer
          disabled: false
          token: "{{enfermeiro_token}}"
          prefix: ""
        settings:
          renderRequestBody: true
          encodeUrl: true
          followRedirects: global
          cookies:
            send: true
            store: true
          rebuildPath: true
      - url: http://localhost:8080/auth/login
        name: 13 - Login Medico
        meta:
          id: req_f8ac2edccd7e45b090ed1affc4c8d51f
          created: 1767565545985
          modified: 1767565545985
          isPrivate: false
          description: ""
          sortKey: -1767565544379
        method: POST
        body:
          mimeType: text/plain
          text: |-
            {
              "usuario": "medico1",
              "senha": "med123"
            }
        headers:
          - name: Content-Type
            value: application/json
        scripts:
          afterResponse: if (insomnia.response.code === 200)
            insomnia.environment.set('medico_token',
            insomnia.response.json().token);
        settings:
          renderRequestBody: true
          encodeUrl: true
          followRedirects: global
          cookies:
            send: true
            store: true
          rebuildPath: true
      - url: http://localhost:8081/consultas
        name: 14 - Medico cria consulta para pac2
        meta:
          id: req_660f85f67dee4ecb937c21f8a0ff104c
          created: 1767565545987
          modified: 1767565545987
          isPrivate: false
          description: ""
          sortKey: -1767565544378
        method: POST
        body:
          mimeType: text/plain
          text: |-
            {
              "idPaciente": {{_['paciente2_profile_id']}},
              "idMedico": {{_['medico_profile_id']}},
              "dataHora": "2026-04-10T09:00:00",
              "observacoes": "Consulta do paciente 2"
            }
        headers:
          - name: Content-Type
            value: application/json
          - name: Authorization
            value: Bearer {{medico_token}}
        authentication:
          type: bearer
          disabled: false
          token: "{{medico_token}}"
          prefix: ""
        scripts:
          afterResponse: if (insomnia.response.code === 201 || insomnia.response.code ===
            200) insomnia.environment.set('consulta_pac2',
            insomnia.response.json().id);
        settings:
          renderRequestBody: true
          encodeUrl: true
          followRedirects: global
          cookies:
            send: true
            store: true
          rebuildPath: true
      - url: http://localhost:8081/consultas/{{consulta_by_enf}}
        name: 15 - Medico atualiza consulta completa (consulta_by_enf)
        meta:
          id: req_5131cdc4e60a4d49934a162fe2675867
          created: 1767565545988
          modified: 1767565545988
          isPrivate: false
          description: ""
          sortKey: -1767565544377
        method: PUT
        body:
          mimeType: text/plain
          text: |-
            {
              "dataHora": "2026-03-01T10:00:00",
              "observacoes": "Reagendada pelo médico"
            }
        headers:
          - name: Content-Type
            value: application/json
          - name: Authorization
            value: Bearer {{medico_token}}
        authentication:
          type: bearer
          disabled: false
          token: "{{medico_token}}"
          prefix: ""
        settings:
          renderRequestBody: true
          encodeUrl: true
          followRedirects: global
          cookies:
            send: true
            store: true
          rebuildPath: true
      - url: http://localhost:8081/consultas/{{consulta_by_enf}}/status
        name: 16 - Medico atualiza status da consulta (consulta_by_enf)
        meta:
          id: req_fe5e8b922adb443ca2c8a63f0cee931f
          created: 1767565545989
          modified: 1767565545989
          isPrivate: false
          description: ""
          sortKey: -1767565544376
        method: PUT
        body:
          mimeType: text/plain
          text: '{ "status": "CONFIRMADA" }'
        headers:
          - name: Content-Type
            value: application/json
          - name: Authorization
            value: Bearer {{medico_token}}
        authentication:
          type: bearer
          disabled: false
          token: "{{medico_token}}"
          prefix: ""
        settings:
          renderRequestBody: true
          encodeUrl: true
          followRedirects: global
          cookies:
            send: true
            store: true
          rebuildPath: true
      - url: http://localhost:8080/auth/login
        name: 17 - Login Paciente 1
        meta:
          id: req_5e77c3388c844ebdb21ab4edb80a3992
          created: 1767565545991
          modified: 1767565545991
          isPrivate: false
          description: ""
          sortKey: -1767565544375
        method: POST
        body:
          mimeType: text/plain
          text: |-
            {
              "usuario": "pac1",
              "senha": "pac123"
            }
        headers:
          - name: Content-Type
            value: application/json
        scripts:
          afterResponse: if (insomnia.response.code === 200)
            insomnia.environment.set('paciente_token',
            insomnia.response.json().token);
        settings:
          renderRequestBody: true
          encodeUrl: true
          followRedirects: global
          cookies:
            send: true
            store: true
          rebuildPath: true
      - url: http://localhost:8081/consultas
        name: 18 - Paciente 1 lista suas consultas (deve ver apenas as do pac1)
        meta:
          id: req_0dec5378739f4328a89d9e03fb503206
          created: 1767565545993
          modified: 1767565545993
          isPrivate: false
          description: ""
          sortKey: -1767565544374
        method: GET
        headers:
          - name: Authorization
            value: Bearer {{paciente_token}}
        authentication:
          type: bearer
          disabled: false
          token: "{{paciente_token}}"
          prefix: ""
        scripts:
          afterResponse: >-
            const body = insomnia.response.json();

            if (Array.isArray(body)) {
              const mismatch = body.find(c => c.idPaciente != insomnia.environment.get('paciente_profile_id'));
              if (mismatch) insomnia.test('Paciente não deve ver consultas de outros', () => { throw new Error('Visibilidade inválida'); });
              else insomnia.test('Paciente vê apenas suas consultas', () => insomnia.expect(true).to.be.true);
            }
        settings:
          renderRequestBody: true
          encodeUrl: true
          followRedirects: global
          cookies:
            send: true
            store: true
          rebuildPath: true
      - url: http://localhost:8081/consultas
        name: 19 - Paciente 1 tenta criar consulta (deve falhar 403)
        meta:
          id: req_f87cfb27008f4757a6e5b169c5f8a5dd
          created: 1767565545996
          modified: 1767565545996
          isPrivate: false
          description: ""
          sortKey: -1767565544373
        method: POST
        body:
          mimeType: text/plain
          text: |-
            {
              "idPaciente": {{_['paciente_profile_id']}},
              "idMedico": {{_['medico_profile_id']}},
              "dataHora": "2026-05-01T08:00:00",
              "observacoes": "Tentativa do paciente"
            }
        headers:
          - name: Content-Type
            value: application/json
          - name: Authorization
            value: Bearer {{paciente_token}}
        authentication:
          type: bearer
          disabled: false
          token: "{{paciente_token}}"
          prefix: ""
        scripts:
          afterResponse: insomnia.test('Paciente não pode criar consulta', () =>
            insomnia.expect(insomnia.response.code).to.not.be.oneOf([200,201]));
        settings:
          renderRequestBody: true
          encodeUrl: true
          followRedirects: global
          cookies:
            send: true
            store: true
          rebuildPath: true
      - url: http://localhost:8080/auth/login
        name: 20 - Login Paciente 2
        meta:
          id: req_a88fa5c5a8f642729c820fe9b7067432
          created: 1767565545998
          modified: 1767565545998
          isPrivate: false
          description: ""
          sortKey: -1767565544372
        method: POST
        body:
          mimeType: text/plain
          text: |-
            {
              "usuario": "pac2",
              "senha": "pac234"
            }
        headers:
          - name: Content-Type
            value: application/json
        scripts:
          afterResponse: if (insomnia.response.code === 200)
            insomnia.environment.set('paciente2_token',
            insomnia.response.json().token);
        settings:
          renderRequestBody: true
          encodeUrl: true
          followRedirects: global
          cookies:
            send: true
            store: true
          rebuildPath: true
      - url: http://localhost:8081/consultas
        name: 21 - Paciente 2 lista suas consultas (deve ver apenas as do pac2)
        meta:
          id: req_7492429e71fa48c19ad01f86cda745ff
          created: 1767565545999
          modified: 1767577861592
          isPrivate: false
          description: ""
          sortKey: -1767565544371
        method: GET
        headers:
          - name: Authorization
            value: Bearer {{paciente2_token}}
        authentication:
          type: bearer
          disabled: false
          token: "{{paciente2_token}}"
          prefix: ""
        settings:
          renderRequestBody: true
          encodeUrl: true
          followRedirects: global
          cookies:
            send: true
            store: true
          rebuildPath: true
      - url: http://localhost:8081/consultas
        name: 22 - Paciente registra consulta (Não Autorizado 403 esperado)
        meta:
          id: req_f5d2f018765b4b96866d02abb3d849e3
          created: 1767577779127
          modified: 1767577868592
          isPrivate: false
          description: ""
          sortKey: -1767565544271
        method: POST
        body:
          mimeType: text/plain
          text: |-
            {
              "idPaciente": {{_['paciente_profile_id']}},
              "idMedico": {{_['medico_profile_id']}},
              "dataHora": "2026-02-20T14:30:00",
              "observacoes": "Criada pelo enfermeiro"
            }
        headers:
          - name: Content-Type
            value: application/json
          - name: Authorization
            value: Bearer {{paciente2_token}}
        authentication:
          type: bearer
          disabled: false
          token: "{{paciente2_token}}"
          prefix: ""
        scripts:
          afterResponse: if (insomnia.response.code === 201 || insomnia.response.code ===
            200) insomnia.environment.set('consulta_by_enf',
            insomnia.response.json().id);
        settings:
          renderRequestBody: true
          encodeUrl: true
          followRedirects: global
          cookies:
            send: true
            store: true
          rebuildPath: true
cookieJar:
  name: Default Jar
  meta:
    id: jar_0f7f68b94a60b31d2b4f5b92b3b8b2eab6e7971a
    created: 1767565546007
    modified: 1767577873305
environments:
  name: Base Environment
  meta:
    id: env_0f7f68b94a60b31d2b4f5b92b3b8b2eab6e7971a
    created: 1767565546001
    modified: 1767577873310
    isPrivate: false
  data:
    admin_token: eyJhbGciOiJIUzI1NiJ9.eyJyb2xlIjoiQURNSU4iLCJzdWIiOiJhZG1pbiIsImlhdCI6MTc2NzU3NzcxOCwiZXhwIjoxNzY3NjY0MTE4fQ.59SGQGylz4JOS4_N9P9980f9GdOTV6GPr2RFvp7xs9c
    medico_profile_id: 1
    enf_profile_id: 2
    paciente_profile_id: 3
    paciente2_profile_id: 4
    enfermeiro_token: eyJhbGciOiJIUzI1NiJ9.eyJyb2xlIjoiRU5GRVJNRUlSTyIsInN1YiI6ImVuZjEiLCJpYXQiOjE3Njc1Nzc3MTksImV4cCI6MTc2NzY2NDExOX0.5Uwz_eeeuacqsXF3OpPWnUXpwoGBXHKUUAKJfyAJFgk
    consulta_by_enf: 3
    medico_token: eyJhbGciOiJIUzI1NiJ9.eyJyb2xlIjoiTUVESUNPIiwic3ViIjoibWVkaWNvMSIsImlhdCI6MTc2NzU3NzcyMCwiZXhwIjoxNzY3NjY0MTIwfQ.MxFbCN0-S_8O_UDyyzySiLt6TCVmuKGtJ3lnSEpluvo
    consulta_pac2: 4
    paciente_token: eyJhbGciOiJIUzI1NiJ9.eyJyb2xlIjoiUEFDSUVOVEUiLCJzdWIiOiJwYWMxIiwiaWF0IjoxNzY3NTc3NzIxLCJleHAiOjE3Njc2NjQxMjF9._fRcvNk48CSSFL-c0oQVw_cj_DHxewm_wWhUNYsloHw
    paciente2_token: eyJhbGciOiJIUzI1NiJ9.eyJyb2xlIjoiUEFDSUVOVEUiLCJzdWIiOiJwYWMyIiwiaWF0IjoxNzY3NTc3NzIyLCJleHAiOjE3Njc2NjQxMjJ9.uD6VGeb4q8mW0t-nWjvVV9Vw89SijnZjHmREWwByC2w
